/* pytesNET/tail.select v.0.5.15 | Basic Version | @author SamBrishes, pytesNET <sam@pytes.net> | @license MIT */
(function(a,b){"function"==typeof define&&define.amd?define(function(){return b(a)}):"object"==typeof module&&module.exports?module.exports=b(a):("undefined"==typeof a.tail&&(a.tail={}),a.tail.select=b(a),"undefined"!=typeof jQuery&&(jQuery.fn.tailselect=function(a){var b,c=[];return this.each(function(){!1!==(b=tail.select(this,a))&&c.push(b)}),1===c.length?c[0]:0!==c.length&&c}),"undefined"!=typeof MooTools&&Element.implement({tailselect:function(a){return new tail.select(this,a)}}))})(window,function(a){"use strict";function b(a,b){return!!(a&&"classList"in a)&&a.classList.contains(b)}function c(a,b){return a&&"classList"in a?a.classList.add(b):void 0}function f(a,b){return a&&"classList"in a?a.classList.remove(b):void 0}function g(a,b,c){if(CustomEvent&&CustomEvent.name)var d=new CustomEvent(b,c);else{var d=m.createEvent("CustomEvent");d.initCustomEvent(b,!!c.bubbles,!!c.cancelable,c.detail)}return a.dispatchEvent(d)}function h(a,b){if("function"==typeof Object.assign)return Object.assign({},a,b||{});var c=Object.constructor();for(var d in a)c[d]=d in b?b[d]:a[d];return c}function j(a,b){var c=m.createElement(a);return c.className=b&&b.join?b.join(" "):b||"",c}var k,m=a.document,d=function(a,b){if(a="string"==typeof a?m.querySelectorAll(a):a,a instanceof NodeList||a instanceof HTMLCollection||a instanceof Array){for(var c=[],e=a.length,f=0;f<e;f++)c.push(new d(a[f],h(b,{})));return 1===c.length?c[0]:0!==c.length&&c}if(!(a instanceof Element)||!(this instanceof d))return!!(a instanceof Element)&&new d(a,b);if(d.inst[a.getAttribute("data-tail-select")])return d.inst[a.getAttribute("data-tail-select")];if(a.getAttribute("data-select")){var g=JSON.parse(a.getAttribute("data-select").replace(/\'/g,"\""));g instanceof Object&&(b=h(b,g))}var j=a.getAttribute("placeholder")||a.getAttribute("data-placeholder");return b="object"==typeof b?b:{},b.multiple="multiple"in b?b.multiple:a.multiple,b.disabled="disabled"in b?b.disabled:a.disabled,b.placeholder=j||b.placeholder||null,b.width="auto"===b.width?a.offsetWidth+50:b.width,b.sourceBind="bindSourceSelect"in b?b.bindSourceSelect:b.sourceBind||!1,b.sourceHide="sourceHide"in b?b.sourceHide:b.sourceHide||!0,b.multiLimit=0<=b.multiLimit?b.multiLimit:1/0,this.e=a,this.id=++d.count,this.con=h(d.defaults,b),this.events={},d.inst["tail-"+this.id]=this,this.init().bind()};return d.version="0.5.15",d.status="beta",d.count=0,d.inst={},d.defaults={animate:!0,classNames:null,csvOutput:!1,csvSeparator:",",descriptions:!1,deselect:!1,disabled:!1,height:350,hideDisabled:!1,hideSelected:!1,items:{},locale:"en",linguisticRules:{ะต:"\u0451",a:"\xE4",o:"\xF6",u:"\xFC",ss:"\xDF"},multiple:!1,multiLimit:1/0,multiPinSelected:!1,multiContainer:!1,multiShowCount:!0,multiShowLimit:!1,multiSelectAll:!1,multiSelectGroup:!0,openAbove:null,placeholder:null,search:!1,searchConfig:["text","value"],searchFocus:!0,searchMarked:!0,searchMinLength:1,searchDisabled:!0,sortItems:!1,sortGroups:!1,sourceBind:!1,sourceHide:!0,startOpen:!1,stayOpen:!1,width:null,cbComplete:void 0,cbEmpty:void 0,cbLoopItem:void 0,cbLoopGroup:void 0},d.strings={en:{all:"All",none:"None",empty:"No Options available",emptySearch:"No Options found",limit:"You can't select more Options",placeholder:"Select an Option...",placeholderMulti:"Select up to :limit Options...",search:"Type in to search...",disabled:"This Field is disabled"},modify:function(a,b,c){if(!(a in this))return!1;if(b instanceof Object)for(var d in b)this.modify(a,d,b[d]);else this[a][b]="string"==typeof c?c:this[a][b];return!0},register:function(a,b){return!!("string"==typeof a&&b instanceof Object)&&(this[a]=b,!0)}},d.prototype={_e:function(a,b,c){if(!(a in this.__))return c?c:a;var a=this.__[a];if("function"==typeof a&&(a=a.call(this,b)),"object"==typeof b)for(var d in b)a=a.replace(d,b[d]);return a},init:function(){var a=this,b=["tail-select"],e=this.con,f=/^[0-9.]+(?:cm|mm|in|px|pt|pc|em|ex|ch|rem|vw|vh|vmin|vmax|\%)$/i,g=!0===e.classNames?this.e.className:e.classNames;b.push(g&&g.push?g.join(" "):g&&g.split?g:"no-classes"),e.hideSelected&&b.push("hide-selected"),e.hideDisabled&&b.push("hide-disabled"),0==e.multiLimit&&b.push("disabled"),e.multiple&&b.push("multiple"),e.deselect&&b.push("deselect"),e.disabled&&b.push("disabled"),this.__=h(d.strings.en,d.strings[e.locale]||{}),this._init=!0,this._query=!1,this.select=j("DIV",b),this.label=j("DIV","select-label"),this.dropdown=j("DIV","select-dropdown"),this.search=j("DIV","dropdown-search"),this.csvInput=j("INPUT","select-search"),null===this.e.getAttribute("tabindex")?this.select.setAttribute("tabindex",0):this.select.setAttribute("tabindex",this.e.getAttribute("tabindex")),e.width&&f.test(e.width)?this.select.style.width=e.width:e.width&&!isNaN(parseFloat(e.width,10))&&(this.select.style.width=e.width+"px"),this.label.addEventListener("click",function(){a.toggle.call(a,a.con.animate)}),this.select.appendChild(this.label),isNaN(parseInt(e.height,10))||(this.dropdown.style.maxHeight=parseInt(e.height,10)+"px"),e.search&&(this.search.innerHTML="<input type=\"text\" class=\"search-input\" />",this.search.children[0].placeholder=this._e("search"),this.search.children[0].addEventListener("input",function(){a.query.call(a,this.value.length>e.searchMinLength?this.value:void 0)}),this.dropdown.appendChild(this.search)),this.select.appendChild(this.dropdown),this.csvInput.type="hidden",e.csvOutput&&(this.csvInput.name=this.e.name,this.e.removeAttribute("name"),this.select.appendChild(this.csvInput)),e.multiple&&e.multiContainer&&(m.querySelector(e.multiContainer)?(this.container=m.querySelector(e.multiContainer),this.container.className+=" tail-select-container"):!0===e.multiContainer&&(this.container=this.label,this.container.className+=" tail-select-container")),this.options=new k(this.e,this);for(var c=this.e.options.length,l=0;l<c;l++)this.options.set(this.e.options[l],!1);for(var n in e.items)"string"==typeof e.items[n]&&(e.items[n]={value:e.items[n]}),this.options.add(e.items[n].key||n,e.items[n].value,e.items[n].group,e.items[n].selected,e.items[n].disabled,e.items[n].description);return this.query(),this.e.nextElementSibling?this.e.parentElement.insertBefore(this.select,this.e.nextElementSibling):this.e.parentElement.appendChild(this.select),e.sourceHide&&("none"==this.e.style.display?(this.select.style.display="none",this.e.setAttribute("data-select-hidden","display")):"hidden"==this.e.style.visibility?(this.select.style.visibiltiy="hidden",this.e.setAttribute("data-select-hidden","visibility")):(this.e.style.display="none",this.e.setAttribute("data-select-hidden","0"))),this.e.setAttribute("data-tail-select","tail-"+this.id),a.con.startOpen&&this.open(e.animate),(e.cbComplete||function(){}).call(this,this.select),(this._init=!1)?this:this},bind:function(){var a=this;return(m.addEventListener("keydown",function(d){var g,h,i,j,k,l=d.keyCode||d.which,m=32==l&&a.select===document.activeElement;if(!m&&(!b(a.select,"active")||0>[13,27,38,40].indexOf(l)))return!1;if(d.preventDefault(),d.stopPropagation(),32===l)return a.open(a.con.animate);if(13==l&&(g=a.dropdown.querySelector(".dropdown-option.hover:not(.disabled)"))&&a.options.select.call(a.options,g),27==l||13==l)return a.close(a.con.animate);if(g=a.dropdown.querySelector(".dropdown-option.hover:not(.disabled)")){f(g,"hover"),i=[(40==l?"next":"previous")+"ElementSibling"];do{if(g=null!==(j=g[i])&&"LI"==g.tagName?j:!!(null!==(j=g.parentElement[i])&&0<j.children.length&&"UL"==j.tagName)&&j.children[40==l?0:j.children.length-1],g&&(!b(g,"dropdown-option")||b(g,"disabled")))continue;break}while(!0)}if(g||40!=l?!g&&38==l&&(k=a.dropdown.querySelectorAll(".dropdown-option:not(.disabled)"),g=k[k.length-1]):g=a.dropdown.querySelector(".dropdown-option:not(.disabled)"),g&&(h=a.dropdown.querySelector(".dropdown-inner"))){var n=function(a){for(var b={top:a.offsetTop,height:a.offsetHeight};(a=a.parentElement)!=h;)b.top+=a.offsetTop;return b}(g);c(g,"hover"),h.scrollTop=Math.max(0,n.top-2*n.height)}return!0}),m.addEventListener("click",function(c){if(!b(a.select,"active")||b(a.select,"idle"))return!1;if(!0===a.con.stayOpen)return!1;for(var d=[a.e,a.select,a.container],e=d.length,f=0;f<e;f++){if(d[f]&&(d[f].contains(c.target)||d[f]==c.target))return!1;if(!c.target.parentElement)return!1}return a.close.call(a,a.con.animate)}),!!!this.con.sourceBind)||(this.e.addEventListener("change",function(b){if(null!=b.detail)return!1;if(b.preventDefault(),b.stopPropagation(),!this.multiple&&this.selectedIndex)a.options.select.call(a.options,this.options[this.selectedIndex]);else{var c=[].concat(a.options.selected),d=[].filter.call(this.querySelectorAll("option:checked"),function(a){return!(0<=c.indexOf(a))||(c.splice(c.indexOf(a),1),!1)});a.options.walk.call(a.options,"unselect",c),a.options.walk.call(a.options,"select",d)}}),!0)},callback:function(a,b,d){var e=a.key.replace(/('|\\)/g,"\\$1"),g=a.group.replace(/('|\\)/g,"\\$1");if("rebuild"==b)return this.query();var h=this.dropdown.querySelector("[data-key='"+e+"'][data-group='"+g+"']");return h&&0<=["select","disable"].indexOf(b)?c(h,"select"==b?"selected":"disabled"):h&&0<=["unselect","enable"].indexOf(b)&&f(h,"unselect"==b?"selected":"disabled"),this.update(a),!0===d||this.trigger("change",a,b)},trigger:function(a){if(this._init)return!1;var b={bubbles:!1,cancelable:!0,detail:{args:arguments,self:this}};"change"==a&&arguments[2]&&0<=arguments[2].indexOf("select")&&(g(this.e,"input",b),g(this.e,"change",b)),g(this.select,"tail::"+a,b);var c,d=[];return Array.prototype.map.call(arguments,function(a,b){0<b&&d.push(a)}),(this.events[a]||[]).forEach(function(a){c=[].concat(d),c.push(a.args||null),(a.cb||function(){}).apply(b.detail.self,c)}),!0},calc:function(){var b=this.dropdown.cloneNode(!0),d=this.con.height,e=0,g=this.dropdown.querySelector(".dropdown-inner");b=this.dropdown.cloneNode(!0),b.style.cssText="height:auto;min-height:auto;max-height:none;opacity:0;display:block;visibility:hidden;",b.style.maxHeight=this.con.height+"px",b.className+=" cloned",this.dropdown.parentElement.appendChild(b),d=d>b.clientHeight?b.clientHeight:d,this.con.search&&(e=b.querySelector(".dropdown-search").clientHeight),this.dropdown.parentElement.removeChild(b);var h=this.select.getBoundingClientRect(),i=a.innerHeight-(h.top+h.height),j=!!(d+e>i)&&h.top>i;return!0===this.con.openAbove||!1!==this.con.openAbove&&j?(j=!0,d=Math.min(d,h.top-10),c(this.select,"open-top")):(j=!1,d=Math.min(d,i-10),f(this.select,"open-top")),g&&(this.dropdown.style.maxHeight=d+"px",g.style.maxHeight=d-e+"px"),this},query:function(a,c){var d,e,f,h,i,k,l=this,m=this.con,n="getAttribute",g=j("DIV","dropdown-inner"),o=a?"finder":"walker",p=a?[a,c]:[m.sortItems,m.sortGroups];for(this._query="string"==typeof a&&a;d=this.options[o].apply(this.options,p);){if(!f||f&&f[n]("data-group")!==d.group)if(e=(m.cbLoopGroup||this.cbGroup).call(this,d.group,a,g),e instanceof Element)f=e,f.setAttribute("data-group",d.group),g.appendChild(f);else break;if(null!==(h=(m.cbLoopItem||this.cbItem).call(this,d,f,a,g))){if(!1===h)break;h.setAttribute("data-key",d.key),h.setAttribute("data-group",d.group),h.addEventListener("click",function(){if(!this.hasAttribute("data-key"))return!1;var a=this[n]("data-key"),b=this[n]("data-group")||"#";l.options.toggle.call(l.options,a,b)&&!1===l.con.stayOpen&&!l.con.multiple&&l.close.call(l,l.con.animate)}),f.appendChild(h)}}var q=g.querySelectorAll("*[data-key]").length;0==q&&(this.con.cbEmpty||function(a){var b=j("SPAN","dropdown-empty");b.innerText=this._e("empty"),a.appendChild(b)}).call(this,g,a),0<q&&m.multiple&&m.multiLimit==1/0&&m.multiSelectAll&&(i=j("BUTTON","tail-all"),k=j("BUTTON","tail-none"),i.innerText=this._e("all"),i.addEventListener("click",function(a){a.preventDefault();var b=l.dropdown.querySelectorAll(".dropdown-inner .dropdown-option");l.options.walk.call(l.options,"select",b)}),k.innerText=this._e("none"),k.addEventListener("click",function(a){a.preventDefault();var b=l.dropdown.querySelectorAll(".dropdown-inner .dropdown-option");l.options.walk.call(l.options,"unselect",b)}),h=j("SPAN","dropdown-action"),h.appendChild(i),h.appendChild(k),g.insertBefore(h,g.children[0]));var r=this.dropdown.querySelector(".dropdown-inner");return this.dropdown[(r?"replace":"append")+"Child"](g,r),b(this.select,"active")&&this.calc(),this.updateCSV().updateLabel()},cbGroup:function(a){var b,c,d=j("UL","dropdown-optgroup"),e=this;return"#"==a?d:(d.innerHTML="<li class=\"optgroup-title\"><b>"+a+"</b></li>",this.con.multiple&&this.con.multiLimit==1/0&&this.con.multiSelectAll&&(b=j("BUTTON","tail-none"),c=j("BUTTON","tail-all"),b.innerText=this._e("none"),b.addEventListener("click",function(a){a.preventDefault();var b=this.parentElement.parentElement.getAttribute("data-group");e.options.all.call(e.options,"unselect",b)}),c.innerText=this._e("all"),c.addEventListener("click",function(a){a.preventDefault();var b=this.parentElement.parentElement.getAttribute("data-group");e.options.all.call(e.options,"select",b)}),d.children[0].appendChild(b),d.children[0].appendChild(c)),d)},cbItem:function(a,b,c){var d=j("LI","dropdown-option"+(a.selected?" selected":"")+(a.disabled?" disabled":""));return c&&0<c.length&&this.con.searchMarked?(c=this.options.applyLinguisticRules(c),d.innerHTML=a.value.replace(new RegExp("("+c+")","i"),"<mark>$1</mark>")):d.innerText=a.value,this.con.descriptions&&a.description&&(d.innerHTML+="<span class=\"option-description\">"+a.description+"</span>"),d},update:function(a){return this.updateLabel().updateContainer(a).updatePin(a).updateCSV(a)},updateLabel:function(a){if(this.container==this.label&&0<this.options.selected.length)return this.label.querySelector(".label-inner")&&this.label.removeChild(this.label.querySelector(".label-inner")),this.label.querySelector(".label-count")&&this.label.removeChild(this.label.querySelector(".label-count")),this;var d,e=this.con,c=this.options.selected.length;return"string"!=typeof a&&(e.disabled?a="disabled":0==this.dropdown.querySelectorAll("*[data-key]").length?a="empty"+(b(this.select,"in-search")?"Search":""):e.multiLimit<=c?a="limit":!e.multiple&&0<this.options.selected.length?a=this.options.selected[0].innerText:"string"==typeof e.placeholder?a=e.placeholder:a="placeholder"+(e.multiple&&e.multiLimit<1/0?"Multi":"")),a=this._e(a,{":limit":e.multiLimit},a),a="<span class=\"label-inner\">"+a+"</span>",d=e.multiShowLimit&&e.multiLimit<1/0,e.multiple&&e.multiShowCount&&(a="<span class=\"label-count\">:c</span>"+a,a=a.replace(":c",c+(d?" / "+e.multiLimit:""))),this.label.innerHTML=a,this},updateContainer:function(a){if(!this.container||!this.con.multiContainer)return this;var b="[data-group='"+a.group+"'][data-key='"+a.key+"']";if(this.container.querySelector(b))return a.selected||this.container.removeChild(this.container.querySelector(b)),this;if(a.selected){var c=this,d=j("DIV","select-handle");d.innerText=a.value,d.setAttribute("data-key",a.key),d.setAttribute("data-group",a.group),d.addEventListener("click",function(a){a.preventDefault(),a.stopPropagation();var b=this.getAttribute("data-key"),d=this.getAttribute("data-group");c.options.unselect.call(c.options,b,d)}),this.container.appendChild(d)}return this},updatePin:function(a){var b=this.dropdown.querySelector(".dropdown-inner ul"),c="li[data-key='"+a.key+"'][data-group='"+a.group+"']";if(!this.con.multiPinSelected||!b||!1!==this._query)return this;if(c=this.dropdown.querySelector(c),a.selected)b.insertBefore(c,b.children[0]);else{for(var d=this.dropdown.querySelector("ul[data-group='"+a.group+"']"),e=this.options[a.index-1],f=!1;e&&e.group==a.group&&!(f=d.querySelector("li[data-key='"+e.key+"']"));)e=this.options[e.index-1];f&&f.nextElementSibling?d.insertBefore(c,f.nextElementSibling):d.appendChild(c)}return this},updateCSV:function(){if(!this.csvInput||!this.con.csvOutput)return this;for(var a=[],b=this.options.selected.length,c=0;c<b;c++)a.push(this.options.selected[c].value);return this.csvInput.value=a.join(this.con.csvSeparator||","),this},open:function(a){if(b(this.select,"active")||b(this.select,"idle")||this.con.disabled)return!1;this.calc();var d=function(){c(g.select,"active"),f(g.select,"idle"),this.dropdown.style.height="auto",this.dropdown.style.overflow="visible",this.label.removeAttribute("style"),this.con.search&&this.con.searchFocus&&this.dropdown.querySelector("input").focus(),this.trigger.call(this,"open")},g=this,i=this.dropdown.style;return!1===a?(i.cssText="height:"+i.maxHeight+";display:block;overflow:hidden;",d.call(this)):(this.label.style.zIndex=25,this.dropdown.style.cssText+="height:0;display:block;overflow:hidden;",c(g.select,"idle"),function a(){var b=parseInt(i.height,10),c=parseInt(i.maxHeight,10);return b>=c?d.call(g):void(i.height=(b+50>c?c:b+50)+"px",setTimeout(a,20))}()),this},close:function(a){if(!b(this.select,"active")||b(this.select,"idle"))return!1;var d=function(){f(this.select,"active"),f(this.select,"idle"),this.dropdown.removeAttribute("style"),this.dropdown.querySelector(".dropdown-inner").removeAttribute("style"),this.trigger.call(this,"close")},g=this,h=this.dropdown;return!1===a?d.call(this):(c(this.select,"idle"),this.dropdown.style.overflow="hidden",function a(){return 0>=parseInt(h.offsetHeight,10)-50?d.call(g):void(h.style.height=parseInt(h.offsetHeight,10)-50+"px",setTimeout(a,20))}()),this},toggle:function(a){return b(this.select,"active")?this.close(a):b(this.select,"idle")?this:this.open(a)},remove:function(){if(this.e.removeAttribute("data-tail-select"),this.e.hasAttribute("data-select-hidden")&&("0"==this.e.getAttribute("data-select-hidden")&&this.e.style.removeProperty("display"),this.e.removeAttribute("data-select-hidden")),Array.prototype.map.call(this.e.querySelectorAll("[data-select-option='add']"),function(a){a.parentElement.removeChild(a)}),Array.prototype.map.call(this.e.querySelectorAll("[data-select-optgroup='add']"),function(a){a.parentElement.removeChild(a)}),this.e.name=this.csvInput.hasAttribute("name")?this.csvInput.name:this.e.name,this.select.parentElement&&this.select.parentElement.removeChild(this.select),this.container)for(var a=this.container.querySelectorAll(".select-handle"),b=a.length,c=0;c<b;c++)this.container.removeChild(a[c]);return this},reload:function(){return this.remove().init()},config:function(a,b,c){if(a instanceof Object){for(var d in a)this.config(d,a[d],!1);return this.reload()?this.con:this.con}return"undefined"==typeof a?this.con:!!(a in this.con)&&("undefined"==typeof b?this.con[a]:(this.con[a]=b,!1!==c&&this.reload(),this))},enable:function(a){return f(this.select,"disabled"),this.e.disabled=!1,this.con.disabled=!1,!1===a?this:this.reload()},disable:function(a){return c(this.select,"disabled"),this.e.disabled=!0,this.con.disabled=!0,!1===a?this:this.reload()},on:function(a,b,c){return!(0>["open","close","change"].indexOf(a)||"function"!=typeof b)&&(a in this.events||(this.events[a]=[]),this.events[a].push({cb:b,args:c instanceof Array?c:[]}),this)},value:function(){return 0==this.options.selected.length?null:this.con.multiple?this.options.selected.map(function(a){return a.value}):this.options.selected[0].value}},k=d.options=function(a,b){return this instanceof k?(this.self=b,this.element=a,this.length=0,this.selected=[],this.disabled=[],this.items={"#":{}},this.groups={},this):new k(a,b)},k.prototype={_r:function(a){return a.replace("disabled","disable").replace("enabled","enable").replace("selected","select").replace("unselected","unselect")},get:function(a,b){if("object"==typeof a&&a.key&&a.group)b=a.group||b,a=a.key;else if(a instanceof Element)"OPTION"==a.tagName?(b=a.parentElement.label||"#",a=a.value||a.innerText):a.hasAttribute("data-key")&&(b=a.getAttribute("data-group")||a.parentElement.getAttribute("data-group")||"#",a=a.getAttribute("data-key"));else if("string"!=typeof a)return!1;return a=/^[0-9]+$/.test(a)?"_"+a:a,!!(b in this.items)&&this.items[b][a]},set:function(a,b){var c=a.value||a.innerText,d=a.parentElement.label||"#";if(d in this.items||(this.items[d]={},this.groups[d]=a.parentElement),c in this.items[d])return!1;var e=/^[0-9]+$/.test(c)?"_"+c:c,f=this.self.con;if(f.multiple&&this.selected.length>=f.multiLimit&&(a.selected=!1),a.selected&&f.deselect&&(!a.hasAttribute("selected")||0==f.multiLimit)&&(a.selected=!1,a.parentElement.selectedIndex=-1),a.hasAttribute("data-description")){var g=j("SPAN");g.innerHTML=a.getAttribute("data-description"),a.setAttribute("data-description",g.innerHTML)}return this.items[d][e]={key:c,value:a.text,description:a.getAttribute("data-description")||null,group:d,option:a,optgroup:"#"==d?void 0:this.groups[d],selected:a.selected,disabled:a.disabled,hidden:a.hidden||!1},this.length++,a.selected&&this.select(this.items[d][e]),a.disabled&&this.disable(this.items[d][e]),!b||this.self.callback(this.items[d][c],"rebuild")},add:function(a,b,c,d,e,f,g){if(a instanceof Object){for(var h in a)this.add(a[h].key||h,a[h].value,a[h].group,a[h].selected,a[h].disabled,a[h].description,!1);return this.self.query()}if(this.get(a,c))return!1;if(c="string"==typeof c?c:"#","#"!==c&&!(c in this.groups)){var i=j("OPTGROUP");i.label=c,i.setAttribute("data-select-optgroup","add"),this.element.appendChild(i),this.items[c]={},this.groups[c]=i}this.self.con.multiple&&this.selected.length>=this.self.con.multiLimit&&(d=!1),e=!!e;var k=m.createElement("OPTION");return k.value=a,k.selected=d,k.disabled=e,k.innerText=b,k.setAttribute("data-select-option","add"),f&&0<f.length&&k.setAttribute("data-description",f),("#"==c?this.element:this.groups[c]).appendChild(k),this.set(k,g)},move:function(a,b,c,d){if(!(a=this.get(a,b)))return!1;if("#"!==c&&!(c in this.groups)){var e=j("OPTGROUP");e.label=c,this.element.appendChild(e),this.items[c]={},this.groups[c]=e,this.groups[c].appendChild(a.option)}return delete this.items[a.group][a.key],a.group=c,a.optgroup=this.groups[c]||void 0,this.items[c][a.key]=a,!d||this.self.query()},remove:function(a,b,c){if(!(a=this.get(a,b)))return!1;a.selected&&this.unselect(a),a.disabled&&this.enable(a),a.option.parentElement.removeChild(a.option);var d=/^[0-9]+$/.test(a.key)?"_"+a.key:a.key;return delete this.items[a.group][d],this.length--,0===Object.keys(this.items[a.group]).length&&(delete this.items[a.group],delete this.groups[a.group]),!c||this.self.query()},is:function(a,b,c){var a=this._r(a),d=this.get(b,c);return!d||0>["select","unselect","disable","enable"].indexOf(a)?null:"disable"==a||"enable"==a?"disable"==a?d.disabled:!d.disabled:("select"==a||"unselect"==a)&&("select"==a?d.selected:!d.selected)},handle:function(a,c,d,e){var f=this.get(c,d),a=this._r(a);if(!f||0>["select","unselect","disable","enable"].indexOf(a))return null;if("disable"==a||"enable"==a)return f.option in this.disabled||"disable"!=a?f.option in this.disabled&&"enable"==a&&this.disabled.splice(this.disabled.indexOf(f.option),1):this.disabled.push(f.option),f.disabled="disable"==a,f.option.disabled="disable"==a,this.self.callback.call(this.self,f,a);var g=b(this.self.select,"disabled")||f.disabled||f.option.disabled,h=this.self.con.multiple&&this.self.con.multiLimit<=this.selected.length,j=!this.self.con.multiple&&0<this.selected.indexOf(f.option),k=0==this.self.con.multiLimit&&!0==this.self.con.deselect,l=!this.self.con.multiple&&!this.self.con.deselect&&!0!==e;if("select"==a){if(g||h||k||j)return!1;if(!this.self.con.multiple)for(var m in this.selected)this.unselect(this.selected[m],void 0,!0);0>this.selected.indexOf(f.option)&&this.selected.push(f.option)}else if("unselect"==a){if(g||l)return!1;this.selected.splice(this.selected.indexOf(f.option),1)}return f.selected="select"==a,f.option.selected="select"==a,f.option[(6<a.length?"remove":"set")+"Attribute"]("selected","selected"),this.self.callback.call(this.self,f,a,e)},enable:function(a,b){return this.handle("enable",a,b,!1)},disable:function(a,b){return this.handle("disable",a,b,!1)},select:function(a,b){return this.handle("select",a,b,!1)},unselect:function(a,b,c){return this.handle("unselect",a,b,c)},toggle:function(a,b){return!!(a=this.get(a,b))&&this.handle(a.selected?"unselect":"select",a,b,!1)},invert:function(a){if(a=this._r(a),0<=["enable","disable"].indexOf(a))var b=this.disabled,c="enable"==a?"disable":"enable";else if(0<=["select","unselect"].indexOf(a))var b=this.selected,c="select"==a?"unselect":"select";var d=Array.prototype.filter.call(this,function(a){return!(a in b)}),e=this;return[].concat(b).forEach(function(a){e.handle.call(e,c,a)}),[].concat(d).forEach(function(b){e.handle.call(e,a,b)}),!0},all:function(a,b){var c=this,d=this;return b in this.items?d=Object.keys(this.items[b]):0<=["unselect","enable"].indexOf(a)&&(d=[].concat("unselect"==a?this.selected:this.disabled)),Array.prototype.forEach.call(d,function(d){c.handle.call(c,a,d,b,!1)}),!0},walk:function(a,b,c){if(b instanceof Array||b.length)for(var d=b.length,e=0;e<d;e++)this.handle.apply(this,[a,b[e],null].concat(c));else if(b instanceof Object){var f=this;if(b.forEach)b.forEach(function(b){f.handle.apply(f,[a,b,null].concat(c))});else for(var g in b)("string"==typeof b[g]||"number"==typeof b[g]||b[g]instanceof Element)&&this.handle.apply(this,[a,b[g],g in this.items?g:null]).concat(c)}return this},applyLinguisticRules:function(a,b){var c=this.self.con.linguisticRules,d=[];return Object.keys(c).forEach(function(a){d.push("("+a+"|["+c[a]+"])")}),b&&(d=d.concat(d.map(function(a){return a.toUpperCase()}))),a.replace(new RegExp(d.join("|"),b?"g":"ig"),function(a){return d[[].indexOf.call(arguments,a,1)-1]})},find:function(a,b){var c,d=this,e={};if(b||(b=this.self.con.searchConfig),"function"==typeof b)c=b.bind(this,a);else{b=b instanceof Array?b:[b],b.forEach(function(a){"string"==typeof a&&(e[a]=!0)}),e.any=e.any?e.any:e.attributes&&e.value,(!e.regex||e.text)&&(a=a.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")),e.exactglyphes||(a=this.self.options.applyLinguisticRules(a,e.case)),e.word&&(a="\\b"+a+"\\b");var f=new RegExp(a,e.case?"m":"mi"),g=function(a){return f.test(a.text||a.value)};if(c=e.any?function(a){return g(a)||[].some.call(a.attributes,g)}:e.attributes?function(a){return[].some.call(a.attributes,g)}:g,!this.self.con.searchDisabled){var h=c;c=function(a){return!a.disabled&&h(a)}}}return[].filter.call(this.self.e.options,c).map(function(a){return!a.hidden&&d.get(a)})},finder:function(a,b){void 0===this._finderLoop&&(this._finderLoop=this.find(a,b));for(var c;void 0!==(c=this._finderLoop.shift());)return c;return delete this._finderLoop,!1},walker:function(a,b){if("undefined"!=typeof this._inLoop&&this._inLoop){if(0<this._inItems.length){do var c=this.items[this._inGroup][this._inItems.shift()];while(!0===c.hidden);return c}if(0<this._inGroups.length){for(;0<this._inGroups.length;){var d=this._inGroups.shift();if(!(d in this.items))return!1;var e=Object.keys(this.items[d]);if(0<e.length)break}return"ASC"==a?e.sort():"DESC"==a?e.sort().reverse():"function"==typeof a&&(e=a.call(this,e)),this._inItems=e,this._inGroup=d,this.walker(null,null)}return delete this._inLoop,delete this._inItems,delete this._inGroup,delete this._inGroups,!1}var f=Object.keys(this.groups)||[];return"ASC"==b?f.sort():"DESC"==b?f.sort().reverse():"function"==typeof b&&(f=b.call(this,f)),f.unshift("#"),this._inLoop=!0,this._inItems=[],this._inGroups=f,this.walker(a,null)}},d});
